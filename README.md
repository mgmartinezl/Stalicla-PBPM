PBPM
==============================

A command line interface program to generate patient by disrupted pathways matrices (PBPMs). \
*Last update: Sep 05, 2019*

Project Organization
------------

    ├── README.md          <- The top-level README for developers using this project.
    │
    ├── analysis           <- The protocol execution logs final and the PBPM matrices created  
    │                         by the code, if an alternative path is not provided under the --path parameter.
    ├── data
    │   ├── processed      <- The intermediate matrices created by the code.
    │   └── raw            <- The original, immutable data dump: patients, mutations and pathways directory.
    │
    ├── environment.yml   <- The requirements file for reproducing the analysis environment.
    │
    ├── notebooks          <- Jupyter notebooks not provided for this project.
    │
    ├── references         <- The PBPM module official presentation.
    │
    ├── reports            <- No specific reports generated by this project.
    │   └── figures        <- No specific graphics or figures generated by this project.
    │
    ├── src                <- Source code for use in this project: module PBPM.py
    │   └── __init__.py    
    │
    ├── main.py            <- Execution script for the src code: main.py


Description
------------
This repository contains the PBPM Python project to generate 
patient by disrupted pathways matrices (also known as PBPMs).
The project's module is function-oriented-programming protocol 
is executed by calling a 
[main script](https://github.com/mgmartinezl/Stalicla-PBPM/blob/master/main.py)
based on the 
[src code](https://github.com/mgmartinezl/Stalicla-PBPM/tree/master/src) 
provided.

How to run this script
------------
This module is written in Python 3 and uses up-to-date libraries 
for this version as well. To run the main module in a Linux environment, 
simply open a new terminal and call the script together with the arguments 
it accepts:

```python3 main.py ``` \
```positional arguments: ``` \
&nbsp;&nbsp;&nbsp;```[inputFile] [pathwaysDirectory]``` \
```optional arguments: ``` \
&nbsp;&nbsp;&nbsp;```[-p PATHWAY, --pathway PATHWAY, --pathways PATHWAY]``` \
&nbsp;&nbsp;&nbsp;```[-g GENE, --gene GENE, --genes GENE]``` \
&nbsp;&nbsp;&nbsp;```[-id PATIENT, --patient PATIENT, --patients PATIENT]``` \
&nbsp;&nbsp;&nbsp;```[-csq CSQ, --consequence CSQ, --consequences CSQ]``` \
&nbsp;&nbsp;&nbsp;```[-pli PLI, --pli_gt PLI]``` \
&nbsp;&nbsp;&nbsp;```[-pr pRECESSIVE, --pr_g pRECESSIVE]``` \
&nbsp;&nbsp;&nbsp;```[-af MAX_AF, --af_lt MAX_AF]``` \
&nbsp;&nbsp;&nbsp;```[-pph2 PPH2, --polyphen PPH2, --polyphen2 PPH2]``` \
&nbsp;&nbsp;&nbsp;```[-mpc MPC, --mpc_gt MPC]``` \
&nbsp;&nbsp;&nbsp;```[-adj_csq ADJ-CSQ, --adjusted_consequence ADJ-CSQ, --adjusted_consequences ADJ-CSQ]``` \
&nbsp;&nbsp;&nbsp;```[-m PBPM-TYPE, --matrix PBPM-TYPE]``` \
&nbsp;&nbsp;&nbsp;```[-im True/False(default), --intermediate_matrix True/False(default)]``` \
&nbsp;&nbsp;&nbsp;```[-a APPEND-FILE, --append APPEND-FILE]``` \
&nbsp;&nbsp;&nbsp;```[--path PATH-RESULTS]``` 


Positional arguments
------------
* **inputFile:** it is mandatory to specify the absolute path to the input file 
containing the patients and their mutations.
    - Example: \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt```
* **pathwaysDirectory:**  it is mandatory to specify the absolute path to the directory that 
contains the pathway files with gene annotations.
    - Example: \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/```

**Important notes:** 
- Be aware of respecting the order of the positional arguments.
- Also, keep the names of the patients and mutations file as follows: \
```Chr, Position, Ref, Alt, Type, Gene, consequence, AA_Change, BP_Change, child_id, HGNC_symbol, HGNC_mapping, constraint_score, pLI, pRecessive, max_control_AF, pph2_prediction, MPC, adjusted_consequence```
- The directory containing the pathways can contain multiple files. However, only those
ending with *'_with_gene_annotations'* will be considered for processing. 

Optional arguments
------------
* **[-p PATHWAY, --pathway PATHWAY, --pathways PATHWAY]:**
optional argument to filter specific pathways. 
If no setting is provided, all available pathways will be considered.
    - Example 1: protocol will filter data for pathway R-HSA-69620 \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -p R-HSA-69620 ```
    - Example 2: protocol will not filter data by any pathway \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ ```    
    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one pathway, you can specify one of the following: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    1. A subset of pathways separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-p R-HSA-69620,0051705 ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    2. A txt tab delimited file with no headers and the desired pathways to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-p ~/PBPM/data/raw/filters/my-file-containing-pathways.txt```

* **[-g GENE, --gene GENE, --genes GENE]:** 
optional argument to filter specific genes. 
If no setting is provided, all available genes will be considered.
    - Example: protocol will filter data for gene CTR9 \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -g CTR9 ```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one gene, you can specify one of the following: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    1. A subset of genes separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-g CTR9,NOCL2 ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    2. A txt tab delimited file with no headers and the desired genes to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-g ~/PBPM/data/raw/filters/my-file-containing-genes.txt``` 

* **[-id PATIENT, --patient PATIENT, --patients PATIENT]:** 
optional argument to filter specific patient IDs. 
If no setting is provided, all available patients will be considered.
    - Example: protocol will filter data for patient with ID 1 \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -id Patient_1 ```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one patient ID, you can specify one of the following: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    1. A subset of patients separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-id Patient_X,Patient_Y ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    2. A txt tab delimited file with no headers and the desired patient IDs to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-id ~/PBPM/data/raw/filters/my-file-containing-patients.txt``` 

* **[-csq CSQ, --consequence CSQ, --consequences CSQ]:** 
optional argument to filter specific consequences. 
If no setting is provided, all available consequences will be considered.
    - Example: protocol will filter data for consequences of type 'missense_variant' \
    ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -csq missense_variant```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one consequence, you can specify one of the following: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    1. A subset of consequences separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-csq missense_variant,Intron ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    2. A txt tab delimited file with no headers and the desired consequences to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;    ```-csq ~/PBPM/data/raw/filters/my-file-containing-mutations.txt``` 

* **[-pli PLI, --pli_gt PLI]:** 
optional argument to filter records with values greater than or equal to a specified 
pLI threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -pli 0.6 ```

* **[-pr pRECESSIVE, --pr_g pRECESSIVE]:**
optional argument to filter records with values greater than a specified 
pRecessive threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -pr 0.6 ```

* **[-af MAX_AF, --af_lt MAX_AF]:** 
optional argument to filter records with values less or equal than a max_control_AF threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -af 0.3 ```

* **[-pph2 PPH2, --polyphen PPH2, --polyphen2 PPH2]:** 
optional argument to filter records with specific PolyPhen predictions. 
Available options for this parameter are: *benign*, *possibly damaging*, 
and *probably damaging*. Note that qualifiers must be enclosed with 
quotes as they hold blank spaces.
    - Example:  ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -pph2 "possibly damaging" ```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one PolyPhen qualifier, you must separate their labels with comma and without spaces while keeping the quotes: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ``` -pph2 "probably damaging,possibly damaging" ```

* **[-mpc MPC, --mpc_gt MPC]:** 
optional argument to filter records with values greater than or equal to a specified 
MPC threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -mpc 0.7 ```

* **[-adj_csq ADJ-CSQ, --adjusted_consequence ADJ-CSQ, --adjusted_consequences ADJ-CSQ]:** 
optional argument to filter records by specific adjusted consequence labels. 
Available options for this parameter include: *PTV*, *Missense3*, *Missense*, etc. 
    - Example:  ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -adj_csq PTV ```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
To filter by more than one adjusted consequence, you must separate their labels with comma: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ``` -adj_csq Missense3,Missense ```

* **[-m PBPM-TYPE, --matrix PBPM-TYPE]:** 
optional argument to select the type of matrix to be extracted. 
It is only possible to generate one matrix at a time.
Available options are: *binary(b)*, *numerical(n)*, *normalized(nn)*. 
If not set, the default value of this argument will return a binary matrix.
    - Example to explicitly generate a binary matrix : \
     ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -m b ```
    - Example to generate a numerical matrix (not normalized): \
      ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -m n ```
    - Example to generate a normalized numerical matrix: \
     ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -m nn ```

* **[-im True/False(default), --intermediate_matrix True/False(default)]:** 
optional boolean argument by default set to False. When set to True, a copy of the 
intermediate matrix to generate the PBPM is downloaded. By specifying the parameter in the
console, it will automatically interpreted as True.
    - Example 1 to download intermediate matrix: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ -im ```
    - Example 2 to download intermediate matrix: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways/ --intermediate_matrix ```

* **[-a APPEND-FILE, --append APPEND-FILE]:** 
optional argument to append the intermediate matrix of the current session to the file provided,
which is expected to be another intermediate matrix. Appended information will be used to
compute the final PBPM. The appended file will be overwritten and it will contain the commands used to generate all the information of the intermediate matrix.

    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways// -a path-to-my-historic-file.txt ```

* **[--path PATH-RESULTS]:** 
optional argument to specify the path where the user wants to store the final PBPM generated.
When not specified, the final PBPMs will be stored in the **analysis** folder of this project.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/mutations-file.txt ~/PBPM/data/raw/pathways// --path location-where-I-want-to-save-PBPM ```

**Note:** help() is available for all the parameters via the command line by running
```python main.py --help``` :smile:


***
<p><small>
For any additional information, contact me :bowtie: 

*Gabriela Martinez* <br>
*airamgabriela17@gmail.com*
</small></p>
***

<p><small>Project based on the <a target="_blank" href="https://drivendata.github.io/cookiecutter-data-science/">cookiecutter data science project template</a>. #cookiecutterdatascience</small></p>
