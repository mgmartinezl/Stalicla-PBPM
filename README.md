PBPM
==============================

A command line interface program to generate patient by disrupted pathways matrices (PBPMs). \
*Last update: Sep 03, 2019*

Project Organization
------------

    ├── README.md          <- The top-level README for developers using this project.
    │
    ├── analysis           <- The protocol execution logs final and the PBPM matrices created  
    │                         by the code, if an alternative path is not provided under the --path parameter.
    ├── data
    │   ├── processed      <- The intermediate matrices created by the code.
    │   └── raw            <- The original, immutable data dump: patients, mutations and pathways directory.
    │
    ├── environment.yml   <- The requirements file for reproducing the analysis environment.
    │
    ├── notebooks          <- Jupyter notebooks not provided for this project.
    │
    ├── references         <- The PBPM module official presentation.
    │
    ├── reports            <- No specific reports generated by this project.
    │   └── figures        <- No specific graphics or figures generated by this project.
    │
    ├── src                <- Source code for use in this project: module PBPM.
    │   └── __init__.py    
    │
    ├── main.py            <- Execution script for the src code: main.py


Description
------------
This repository contains the PBPM Python project to generate 
patient by disrupted pathways matrices (also known as PBPMs).

This function-oriented-programming protocol is executed by 
calling a [main script]()
based on the [src code]() 
provided.

How to run this script
------------

This module is written in Python 3 and uses up-to-date libraries 
for this version as well. To run the main module in a Linux environment, 
simply open a new terminal and call the script together with the arguments 
it accepts:

```python3 main.py ``` \
```positional arguments: ``` \
&nbsp;&nbsp;&nbsp;```[inputFile] [pathwaysDirectory]``` \
```optional arguments: ``` \
&nbsp;&nbsp;&nbsp;```[-p PATHWAY, --pathway PATHWAY, --pathways PATHWAY]``` \
&nbsp;&nbsp;&nbsp;```[-g GENE, --gene GENE, --genes GENE]``` \
&nbsp;&nbsp;&nbsp;```[-id PATIENT, --patient PATIENT, --patients PATIENT]``` \
&nbsp;&nbsp;&nbsp;```[-csq CSQ, --consequence CSQ, --consequences CSQ]``` \
&nbsp;&nbsp;&nbsp;```[-pli PLI, --pli_gt PLI]``` \
&nbsp;&nbsp;&nbsp;```[-pr pRECESSIVE, --pr_g pRECESSIVE]``` \
&nbsp;&nbsp;&nbsp;```[-af MAX_AF, --af_lt MAX_AF]``` \
&nbsp;&nbsp;&nbsp;```[-pph2 PPH2, --polyphen PPH2, --polyphen2 PPH2]``` \
&nbsp;&nbsp;&nbsp;```[-mpc MPC, --mpc_gt MPC]``` \
&nbsp;&nbsp;&nbsp;```[-adj_csq ADJ-CSQ, --adjusted_consequence ADJ-CSQ, --adjusted_consequences ADJ-CSQ]``` \
&nbsp;&nbsp;&nbsp;```[-m PBPM-TYPE, --matrix PBPM-TYPE]``` \
&nbsp;&nbsp;&nbsp;```[-im True/False(default), --intermediate_matrix True/False(default)]``` \
&nbsp;&nbsp;&nbsp;```[-a APPEND-FILE, --append APPEND-FILE]``` \
&nbsp;&nbsp;&nbsp;```[--path PATH-RESULTS]``` \


#### Positional parameters

* **inputFile:** it is mandatory to specify the absolute path to the input file containing the 
patient mutations.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt```
* **pathwaysDirectory:**  it is mandatory to specify the absolute path to the directory that 
contains the pathway files with gene annotations.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/```

#### Optional parameters

* **-pathway:** optional argument to extract only specific pathways. If no setting is provided,
all available pathways will be extracted by default.
    - Example 1: it will run only for pathway R-HSA-69620 \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -pathway R-HSA-69620 ```
    - Example 2: it will run for all possible pathways \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ ```    
    
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For more than one pathway, you can specify one of the following: \
\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Subset of pathways separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-pathway R-HSA-69620,0051705 ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * A txt tab delimited file with no headers and the desired pathways to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-pathway ~/PBPM/data/raw/filters/my-file-containing-pathways.txt```

* **-gene:** optional argument to extract only specific genes. If no setting is provided,
all available genes will be extracted by default.
    - Example: it will run only for gene CTR9 \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -gene CTR9 ```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For more than one gene, you can specify one of the following: \
\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Subset of genes separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-gene CTR9,NOCL2 ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * A txt tab delimited file with no headers and the desired genes to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-gene ~/PBPM/data/raw/filters/my-file-containing-genes.txt``` 

* **-patient:** optional argument to extract only specific patient IDs. If no setting is provided,
all available patients will be extracted by default.
    - Example: it will run only for patient with ID 1 \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -patient Patient_1 ```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For more than one patient ID, you can specify one of the following: \
\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Subset of patients separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-patient Patient_X,Patient_Y ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * A txt tab delimited file with no headers and the desired patient IDs to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-patient ~/PBPM/data/raw/filters/my-file-containing-patients.txt``` 

* **-csq:** optional argument to extract only specific consequences. If no setting is provided,
all available consequences will be processed by default.
    - Example: it will run only for mutations of type 'missense_variant' \
    ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -csq missense_variant```
   
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; For more than one consequence, you can specify one of the following: \
\
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * Subset of mutations separated by comma (without spaces):  \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-csq missense_variant,Intron ``` \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * A txt tab delimited file with no headers and the desired consequences to filter written in the first column: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ```-csq ~/PBPM/data/raw/filters/my-file-containing-mutations.txt``` 

* **-pli_gt:** optional argument to filter records with values greater than or equal to a specified pLI threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -pli_gt 0.6 ```
   
* **-af_lt:** optional argument to filter records with values less or equal than a max_control_AF threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -af_lt 0.3 ```

* **-pph2:** optional argument to filter records for qualifiers of pph2 predictions. Available options for this
parameter are: *benign*, *possibly damaging*, and *probably damaging*. Note that qualifiers must be enclosed with 
quotes as they hold blank spaces.
    - Example:  ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -pph2 "possibly damaging" ```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; To filter more than one pph2 qualifier, you must separate their labels with comma and without spaces while keeping the quotes: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ``` -pph2 "probably damaging,possibly damaging" ```

* **-mpc_gt:** optional argument to filter records with values greater than or equal to a specified MPC threshold.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -mpc_gt 0.7 ```

* **-adj_csq:** optional argument to filter records by specific value(s) of adjusted consequence. Available options for this
parameter include: *PTV*, *Missense3*, *Missense*, etc. 
    - Example:  ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -adj_csq PTV ```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; To filter more than one pph2 qualifier, you must separate their labels with comma: \
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ``` -adj Missense3,Missense ```

* **-matrix:** optional argument to select the type of matrix to be extracted. It is only possible to generate one matrix at a time.
Available options are: *binary(b)*, *numerical(n)*, *normalized(nn)*. If not set, the default value of this argument will return a binary matrix.
    - Example to explicitly generate a binary matrix : \
     ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -matrix b ```
    - Example to generate a numerical matrix (not normalized): \
      ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -matrix n ```
    - Example to generate a normalized numerical matrix: \
     ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -matrix nn ```

* **-r:** set this parameter to yes (y) to download a copy of the base matrix (raw data) generated to build the PBP matrix. 
By default, this parameter is set to no (n).
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways/ -r y ```

* **-append:** when this parameter is specified, the base matrix of the current session will be appended to the file provided. 
Thus, it will not be necessary to explicitly set the -r parameter to 'yes', unless a separate copy of the base matrix is desired.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways// -append path-to-my-historic-file.txt ```

* **-path:** specifies the path where the user wants to store the final PBPM generated.
    - Example: ```$ python3 main.py ~/PBPM/data/raw/original-mutations-file.txt ~/PBPM/data/raw/pathways// -path location-where-I-want-to-save-PBPM ```


**Note:** help() is available for all the parameters via the command line. 

### Input files

A sample of the file required by the first argument (the input file containing mutations and 
patients) can be found in the folder **data/raw** of the repo. The name of the file is
 **original-mutations-file.txt**. Also, a file called **

Similarly, in the [**data/raw/pathways**] folder, a sample of a directory containing pathways 
can be found, which is a mandatory parameter for _pathwaysDirectory_ entry. 

Additional example text files to filter can be found in the folder **data/raw/filters**.

### Running tests

In the folder [reports](https://github.com/mgmartinezl/Stalicla-PBPM/tree/master/reports), 
three different running examples can be found. Each of them generates a log containing the 
parameters set to run the program, as well as the desired output. To see the logs please 
visit **~/PBPM/analysis**.

For any additional information, contact me: 

*Gabriela Martinez* <br>
*airamgabriela17@gmail.com*

--------

<p><small>Project based on the <a target="_blank" href="https://drivendata.github.io/cookiecutter-data-science/">cookiecutter data science project template</a>. #cookiecutterdatascience</small></p>
